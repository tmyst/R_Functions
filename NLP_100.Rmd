---
title: "NLP_100"
author: "tmyst"
date: "2016年6月3日"
output: html_document
---

```{r setup, include=FALSE}
# knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# ライブラリの読み込み
library(readxl)
library(readr)
library(stringr)
library(plyr)
library(tidyr)
library(dplyr)
library(ggplot2)
```


```{r}
# -------------------------自然言語処理100本ノック-------------------------
# 0
ch <- "stressed"
str_split("stressed", "")[[1]] %>% rev %>% as.list %>% do.call(paste0, .)
# Using do.call
str_split("stressed", "")[[1]] %>% rev %>% paste(collapse="")
# A little shorter ver.
sapply(lapply(strsplit("stressed", NULL), rev), paste, collapse="")
# A bit complicated
```

```{r}
# 1
ch <- "パタトクカシーーー"
extact_ix <- c(1, 3, 5, 7)
paste(str_split(ch, "")[[1]][extact_ix], collapse="")
```

```{r}
# 2
# 若干一般化
ch1 <- "パトカー"
ch2 <-"タクシ"

strlist <- list(ch1, ch2)
chmat <- matrix("", max(sapply(strlist, function(x)str_length(x))), length(strlist))

for(i in 1:length(strlist)){
  chmat[1:str_length(strlist[[i]]), i] <- c(str_split(strlist[[i]], ""))[[1]]
}
chmat %>% t %>% as.vector %>% paste(collapse="")

```

```{r}
# 3
sent <- "Now I need a drink, alcoholic of course, after the heavy lectures involving quantum mechanics."
lapply(str_split(sent, " "), function(x)str_length(gsub(x, pattern="(\\.|\\,)", replacement="", perl=T)))[[1]]
sprintf("%1.14f", pi)

```


```{r}
# 4
sent <- "Hi He Lied Because Boron Could Not Oxidize Fluorine. New Nations Might Also Sign Peace Security Clause. Arthur King Can."
strg <- str_split(sent, " ")[[1]]

char1_ix <- c(1, 5, 6, 7, 8, 9, 15, 16, 19)
char2_ix <- setdiff(1:length(strg), char1_ix)

char1_st <- sapply(strg[char1_ix], function(x)str_split(x, "")[[1]][1])
char2_st <- sapply(strg[char2_ix], function(x)paste(str_split(x, "")[[1]][1:2], collapse=""))

c(paste(char1_st, char1_ix, sep = ":"), paste(char2_st, char2_ix, sep = ":")) %>% sort

```

```{r}
# 5
sent <- ""

char_ngram <- function(sent, n){
  sent_trim <- lapply(str_split(sent, " "), function(x)str_replace(x, pattern="(\\s)", replacement=""))[[1]] %>% paste(collapse="")

  sent_trim_split <- str_split(sent_trim, pattern = "")[[1]]
  sent_list <- list()
  for(i in 1:n){
    sent_list[[i]] <- sent_trim_split %>% lead(i-1)
  }
  chars <- do.call(paste0, sent_list)[1:(length(sent_trim_split)-n+1)] %>% unique
  pos_list <- sapply(chars, function(x)str_locate_all(sent, x))
  pos <- sapply(pos_list, function(x)ifelse(length(x)!=0, paste(x[,1], collapse=", "), NA))
  
  data.frame(chars, pos)
}

word_ngram <- function(sent, n){
  sent_split <- str_split(sent, " ")[[1]]
  sent_list <- list()
  for(i in 1:n){
    sent_list[[i]] <- sent_split %>% lead(i-1)
  }
  words <- do.call(paste, sent_list)[1:(length(sent_split)-n+1)] %>% unique
  pos_list <- sapply(words, function(x)str_locate_all(sent, x))
  pos <- sapply(pos_list, function(x)ifelse(length(x)!=0, paste(x[,1], collapse=", "), NA))
  data.frame(words, pos)
}

char_ngram(sent, 2)
word_ngram(sent, 2)

```

```{r}
# 6

```


```{r}
# 7

```


```{r}
# 8

```


```{r}
# 9

```


